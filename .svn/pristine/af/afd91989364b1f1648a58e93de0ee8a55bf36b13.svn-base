{extend name="index/base" /} {block name="style"}
<link rel="stylesheet" type="text/css" href="__CSS__/common/swiper.min.css">
<link rel="stylesheet" type="text/css" href="__CSS__/mescroll/mescroll.min.css">
<link rel="stylesheet" type="text/css" href="__CSS__/index/yy_notice.css">
<style>
    .mescroll-upwarp {
        padding: 0.5rem 0 1.6rem 0;
    }

    .layui-layer-msg {
        width: 3.8rem;
    }
</style>
{/block}
{block name="content"}
<main style="margin-top: 0">
    <div class="yy_notice_header">
        <img src="__STATIC__/icon/publish/icon_nav_back@2x.png" alt="" class="go_back">
        <span>吖吖公告</span>
    </div>

    <div class="yy_main_banner">
        <div class="swiper-container1">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <img src="/uploads/wi_img/20180731/67e38ba812963729ef2fbcca80710cd5.png" alt="">
                    <div class="yy_main_banner_tips">
                        <span></span>
                        <span>第27期 人气王已揭晓</span>
                        <p>IPhone XS Max 才刚上市！就被她拿走了！天啊！</p>
                    </div>

                </div>
                <div class="swiper-slide">
                    <img src="/uploads/wi_img/20180731/67e38ba812963729ef2fbcca80710cd5.png" alt="">
                    <div class="yy_main_banner_tips">
                        <span></span>
                        <span>第27期 人气王已揭晓</span>
                        <p>IPhone XS Max 才刚上市！就被她拿走了！天啊！</p>
                    </div>

                </div>
                <div class="swiper-slide">
                    <img src="/uploads/wi_img/20180731/67e38ba812963729ef2fbcca80710cd5.png" alt="">
                    <div class="yy_main_banner_tips">
                        <span></span>
                        <span>第27期 人气王已揭晓</span>
                        <p>IPhone XS Max 才刚上市！就被她拿走了！天啊！</p>
                    </div>

                </div>

            </div>
            <div class="swiper-pagination"></div>
        </div>
    </div>

    <div class="yy_prize">
        <div class="yy_prize_top">
            <span class="lf">往期中奖者</span>
            <span class="rt">全部中奖者 ></span>
        </div>
        <div class="yy_prize_banner">
            <div class="swiper-container2">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <img src="/uploads/m_avatar/20181016/1539671363240886860.jpg" alt="" class="prize_img">
                        <div class="yy_prize_banner_main">
                            <img src="__STATIC__/image/index/icon_zhognjiang1@2x.png" alt="">
                            <span class="prize_name">拍**酱</span>
                            <p class="prize_pd_name">iPhone XS 64Ghahahhahahha</p>
                            <p class="prize_tips">共17人团中</p>
                        </div>

                    </div>
                    <div class="swiper-slide">
                        <img src="/uploads/m_avatar/20181016/1539671363240886860.jpg" alt="" class="prize_img">
                        <div class="yy_prize_banner_main">
                            <img src="__STATIC__/image/index/icon_zhognjiang1@2x.png" alt="">
                            <span class="prize_name">拍**酱1</span>
                            <p class="prize_pd_name">iPhone XS 64Ghahahhahahha</p>
                            <p class="prize_tips">共17人团中</p>
                        </div>

                    </div>
                    <div class="swiper-slide">
                        <img src="/uploads/m_avatar/20181016/1539671363240886860.jpg" alt="" class="prize_img">
                        <div class="yy_prize_banner_main">
                            <img src="__STATIC__/image/index/icon_zhognjiang1@2x.png" alt="">
                            <span class="prize_name">拍**酱2</span>
                            <p class="prize_pd_name">iPhone XS 64Ghahahhahahha</p>
                            <p class="prize_tips">共17人团中</p>
                        </div>

                    </div>
                    <div class="swiper-slide">
                        <img src="/uploads/m_avatar/20181016/1539671363240886860.jpg" alt="" class="prize_img">
                        <div class="yy_prize_banner_main">
                            <img src="__STATIC__/image/index/icon_zhognjiang1@2x.png" alt="">
                            <span class="prize_name">拍**酱3</span>
                            <p class="prize_pd_name">iPhone XS 64Ghahahhahahha</p>
                            <p class="prize_tips">共17人团中</p>
                        </div>

                    </div>
                    <div class="swiper-slide">
                        <img src="/uploads/m_avatar/20181016/1539671363240886860.jpg" alt="" class="prize_img">
                        <div class="yy_prize_banner_main">
                            <img src="__STATIC__/image/index/icon_zhognjiang1@2x.png" alt="">
                            <span class="prize_name">拍**酱4</span>
                            <p class="prize_pd_name">iPhone XS 64Ghahahhahahha</p>
                            <p class="prize_tips">共17人团中</p>
                        </div>

                    </div>
                    <div class="swiper-slide">
                        <img src="/uploads/m_avatar/20181016/1539671363240886860.jpg" alt="" class="prize_img">
                        <div class="yy_prize_banner_main">
                            <img src="__STATIC__/image/index/icon_zhognjiang1@2x.png" alt="">
                            <span class="prize_name">拍**酱5</span>
                            <p class="prize_pd_name">iPhone XS 64Ghahahhahahha</p>
                            <p class="prize_tips">共17人团中</p>
                        </div>

                    </div>
                    <div class="swiper-slide">
                        <img src="/uploads/m_avatar/20181016/1539671363240886860.jpg" alt="" class="prize_img">
                        <div class="yy_prize_banner_main">
                            <img src="__STATIC__/image/index/icon_zhognjiang1@2x.png" alt="">
                            <span class="prize_name">拍**酱6</span>
                            <p class="prize_pd_name">iPhone XS 64Ghahahhahahha</p>
                            <p class="prize_tips">共17人团中</p>
                        </div>

                    </div>
                    <div class="swiper-slide">
                        <img src="/uploads/m_avatar/20181016/1539671363240886860.jpg" alt="" class="prize_img">
                        <div class="yy_prize_banner_main">
                            <img src="__STATIC__/image/index/icon_zhognjiang1@2x.png" alt="">
                            <span class="prize_name">拍**酱7</span>
                            <p class="prize_pd_name">iPhone XS 64Ghahahhahahha</p>
                            <p class="prize_tips">共17人团中</p>
                        </div>

                    </div>


                </div>
            </div>
        </div>
    </div>


    <div class="yy_notice_content">
        <div class="swiper-container3" id="topNav">
            <div class="swiper-wrapper">
                <div class="swiper-slide item active">咨询公告</div>
                <div class="swiper-slide item">吖吖新闻</div>
                <div class="swiper-slide item">好物订阅</div>
                <div class="swiper-slide item">精选推荐</div>
                <div class="swiper-slide item">火爆新闻</div>
                <div class="swiper-slide item">一折抢购</div>
            </div>
        </div>


        <div id="swiper" class="swiper-container4">
            <div id="swiperWrapper" class="swiper-wrapper">

                <!--咨询公告-->
                <div id="mescroll0" class="mescroll swiper-slide">
                    <ul id="dataList0" class="data-list">
                        <!--<li class="content_item clear">-->
                        <!--<div class="content_item_detail lf">-->
                        <!--<p class="content_item_tit">iPhone8P：基本可以和iPhoneXsMax说再见了</p>-->
                        <!--<p class="content_item_data">2018-10-24 15:24 · 评论</p>-->
                        <!--</div>-->
                        <!--<img src="" alt="" class="rt">-->
                        <!--</li>-->
                    </ul>
                </div>

                <!--吖吖新闻-->
                <div id="mescroll1" class=" mescroll swiper-slide">
                    <ul id="dataList1" class="data-list"></ul>
                </div>

                <!--好物订阅-->
                <div id="mescroll2" class=" mescroll swiper-slide">
                    <ul id="dataList2" class="data-list"></ul>
                </div>

                <!--精选推荐-->
                <div id="mescroll3" class=" mescroll swiper-slide">
                    <ul id="dataList3" class="data-list"></ul>
                </div>


                <!--火爆新闻-->
                <div id="mescroll4" class=" mescroll swiper-slide">
                    <ul id="dataList4" class="data-list"></ul>
                </div>


                <!--一折抢购-->
                <div id="mescroll5" class=" mescroll swiper-slide">
                    <ul id="dataList5" class="data-list"></ul>
                </div>
            </div>
        </div>
    </div>
</main>
{/block}
{block name="script"}
{include file="common/js_sdk" /}
<script src="__JS__/common/swiper.min.js"></script>
<script src="__JS__/mescroll/mescroll.min.js"></script>
<script>
    $(function () {
        var mySwiper1 = new Swiper('.swiper-container1', {
            autoplay: 2000,//可选选项，自动滑动
            loop: true,//循环
            pagination: '.swiper-pagination',
        })

        var mySwiper2 = new Swiper('.swiper-container2', {
            slidesPerView: 3,
            spaceBetween: 20,
        })

        var mySwiper3 = new Swiper('#topNav', {
            freeMode: true,
            freeModeMomentumRatio: 0.5,
            slidesPerView: 'auto',
            onTransitionEnd: function (swiper) {
                var i = swiper.activeIndex;//轮播切换完毕的事件
                console.log(i);
                mySwiper.slideTo(i);

                changePage(i);
            }

        });

        var swiperWidth = mySwiper3.clientWidth
        var maxTranslate = mySwiper3.maxTranslate();
        var maxWidth = -maxTranslate + swiperWidth / 2;

        // $(".swiper-container3").on('touchstart', function (e) {
        //     e.preventDefault()
        // })


        //导航菜单
        var mescrollArr = new Array(6);//每个菜单对应一个mescroll对象

        //当前菜单下标
        var curNavIndex = 0;

        //初始化首页
        mescrollArr[0] = initMescroll(0);

        /*初始化轮播*/
        var mySwiper = new Swiper('#swiper', {
            initialSlide: 0,
            onTransitionEnd: function (swiper) {
                var i = swiper.activeIndex;//轮播切换完毕的事件
                mySwiper3.slideTo(i);

                changePage(i);
            }
        });

// 头部点击事件
        mySwiper3.on('tap', function (swiper, e) {
            var i = mySwiper3.clickedIndex;
            var slide = mySwiper3.slides[i];
            var slideLeft = slide.offsetLeft;
            var slideWidth = slide.clientWidth;
            var slideCenter = slideLeft + slideWidth / 2;
            mySwiper.slideTo(i);//以轮播的方式切换列表
            // 被点击slide的中心点

            mySwiper3.setWrapperTransition(300);

            if (slideCenter < swiperWidth / 2) {

                mySwiper3.setWrapperTranslate(0)

            } else if (slideCenter > maxWidth) {

                mySwiper3.setWrapperTranslate(maxTranslate)

            } else {

                var nowTlanslate = slideCenter - swiperWidth / 2;

                mySwiper3.setWrapperTranslate(-nowTlanslate)

            }
            // if (curNavIndex != i) {
                $("#topNav  .active").removeClass('active');

                $("#topNav .swiper-slide").eq(swiper.clickedIndex).addClass('active');



        })

        $(".swiper-container3 .swiper-slide").each(function (n, dom) {
            if (dom.getAttribute("i") == 0) {
                curNavDom = dom;
            }
        });
        /*切换列表*/
        function changePage(i) {
            if (curNavIndex != i) {
                //更改列表条件
                var curNavDom;//当前菜单项
                $(".swiper-container3 .swiper-slide").each(function (n, dom) {
                    if (dom.getAttribute("i") == i) {
                        dom.classList.add("active");
                        curNavDom = dom;
                    } else {
                        dom.classList.remove("active");
                    }
                });

                //隐藏当前回到顶部按钮
                mescrollArr[curNavIndex].hideTopBtn();
                //取出菜单所对应的mescroll对象,如果未初始化则初始化
                if (mescrollArr[i] == null) {
                    mescrollArr[i] = initMescroll(i);
                } else {
                    //检查是否需要显示回到到顶按钮
                    var curMescroll = mescrollArr[i];
                    var curScrollTop = curMescroll.getScrollTop();
                    if (curScrollTop >= curMescroll.optUp.toTop.offset) {
                        curMescroll.showTopBtn();
                    } else {
                        curMescroll.hideTopBtn();
                    }
                }
                //更新标记
                curNavIndex = i;
                $("#topNav  .active").removeClass('active');
                $("#topNav .swiper-slide").eq(i).addClass('active');
            }
        }


        /*创建MeScroll对象*/
        function initMescroll(index) {
            //创建MeScroll对象,内部已默认开启下拉刷新,自动执行up.callback,刷新列表数据;
            var mescroll = new MeScroll("mescroll" + index, {
                //下拉刷新
                down: {
                    isLock: true, //锁定下拉
                },
                //上拉加载的配置项
                up: {
                    callback: getListData, //上拉回调,此处可简写; 相当于 callback: function (page) { getListData(page); }
                    isBounce: false, //此处禁止ios回弹,解析(务必认真阅读,特别是最后一点): http://www.mescroll.com/qa.html#q10
                    noMoreSize: 1, //如果列表已无数据,可设置列表的总数量要大于半页才显示无更多数据;避免列表数据过少(比如只有一条数据),显示无更多数据会不好看; 默认5
                    empty: {
                        tip: "暂无消息~", //提示
                    },
                    // page: {
                    //     size: 6
                    // },
                    loadFull: {
                        use: true,
                    },
                    clearEmptyId: "dataList" + index,
                    htmlLoading: '<p class="upwarp-progress mescroll-rotate"></p><p class="upwarp-tip">加载中..</p>', //上拉加载中的布局
                    htmlNodata: '<p class="upwarp-nodata">我是有底线的~</p>', //无数据的布局
                }
            });
            return mescroll;
        }

        /*联网加载列表数据  page = {num:1, size:10}; num:当前页 从1开始, size:每页数据条数 */
        function getListData(page) {
            //联网加载数据
            var dataIndex = curNavIndex; //记录当前联网的nav下标,防止快速切换时,联网回来curNavIndex已经改变的情况;
            getListDataFromNet(dataIndex, page.num, page.size, function (pageData, totle_num) {
                //联网成功的回调,隐藏下拉刷新和上拉加载的状态;
                //mescroll会根据传的参数,自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据;
                //console.log("dataIndex="+dataIndex+", curNavIndex="+curNavIndex+", page.num="+page.num+", page.size="+page.size+", pageData.length="+pageData.length);

                //方法一(推荐): 后台接口有返回列表的总页数 totalPage
                // mescrollArr[dataIndex].endByPage(pageData.length, totalPage); //必传参数(当前页的数据个数, 总页数)

                //方法二(推荐): 后台接口有返回列表的总数据量 totalSize
                mescrollArr[dataIndex].endBySize(pageData.length, totle_num); //必传参数(当前页的数据个数, 总数据量)

                //方法三(推荐): 您有其他方式知道是否有下一页 hasNext
                //mescrollArr[dataIndex].endSuccess(pageData.length, hasNext); //必传参数(当前页的数据个数, 是否有下一页true/false)

                //方法四 (不推荐),会存在一个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据当前页的数据个数判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.
                //  mescrollArr[dataIndex].endSuccess(pageData.length,totle_num);

                //设置列表数据
                setListData(pageData, dataIndex);
            }, function () {
                //联网失败的回调,隐藏下拉刷新和上拉加载的状态;
                mescrollArr[dataIndex].endErr();
            });
        }

        /*设置列表数据
         * pageData 当前页的数据
         * dataIndex 数据属于哪个nav */
        function setListData(pageData, dataIndex) {
            var listDom = document.getElementById("dataList" + dataIndex);
            for (var i = 0; i < pageData.length; i++) {
                var pd = pageData[i];
                // if (pd.gp_market_price >= 0 && pd.gp_market_price <= 1000) {
                //     img = '<img src="__STATIC__/image/index/icon_home_hundred@2x.png" alt="">'
                // }
                // if (pd.gp_market_price >= 1001 && pd.gp_market_price <= 10000) {
                //     img = '<img src="__STATIC__/image/index/icoc_home_thousand@2x.png" alt="">'
                // }
                // if (pd.gp_market_price >= 10001) {
                //     img = '<img src="__STATIC__/image/index/icon_home_wan@2x.png" alt="">'
                // }

                var str = '<li class="content_item clear">';
                str += '<div class="content_item_detail lf">';
                str += '<p class="content_item_tit">iPhone8P：基本可以和iPhoneXsMax说再见了</p>';
                str += '<p class="content_item_data">2018-10-24 15:24 · 评论</p>';
                str += ' </div>';
                str += '<img src="" alt="" class="rt">';
                str += '</li>';

                var liDom = document.createElement("a");
                liDom.setAttribute('href', '/member/goodsproduct/index/g_id/' + pd.g_id);
                liDom.innerHTML = str;
                listDom.appendChild(liDom);
                $('img').on('error', function () {
                    $(this).attr('src', '/static/image/index/pic_home_taplace@2x.png');
                });
            }
        }

        /*联网加载列表数据
         在您的实际项目中,请参考官方写法: http://www.mescroll.com/api.html#tagUpCallback
         请忽略getListDataFromNet的逻辑,这里仅仅是在本地模拟分页数据,本地演示用
         实际项目以您服务器接口返回的数据为准,无需本地处理分页.
         * */
        function getListDataFromNet(curNavIndex, pageNum, pageSize, successCallback, errorCallback) {
            if (curNavIndex == 0) {
                var url = '/index/index/ajax_top_two_list/state/1/page/' + pageNum + '/page_size/' + pageSize;
            } else if (curNavIndex == 1) {
                var url = '/index/index/ajax_top_two_list/state/2/page/' + pageNum + '/page_size/' + pageSize;
            } else if (curNavIndex == 2) {
                var url = '/index/index/ajax_top_two_list/state/3/page/' + pageNum + '/page_size/' + pageSize;
            } else if (curNavIndex == 3) {
                var url = '/index/index/ajax_top_two_list/state/3/page/' + pageNum + '/page_size/' + pageSize;
            } else if (curNavIndex == 4) {
                var url = '/index/index/ajax_top_two_list/state/3/page/' + pageNum + '/page_size/' + pageSize;
            } else if (curNavIndex == 5) {
                var url = '/index/index/ajax_top_two_list/state/3/page/' + pageNum + '/page_size/' + pageSize;
            }
            //延时一秒,模拟联网
            setTimeout(function () {
                $.ajax({
                    type: 'GET',
                    url: url,
                    dataType: 'json',
                    success: function (data) {
                        var listData = [];
                        for (var i = 0; i < data.list.length; i++) {
                            listData.push(data.list[i]);
                        }
                        //回调
                        successCallback(listData, data.totle_num);
                    },
                    error: errorCallback
                });
            }, 500)
        }


        $('.go_back').click(function () {
            window.history.back();
        })
    })


</script>
{/block}